<div id="root"></div>

<script>
    console.clear();

    import React, { useState, useEffect } from "https://esm.sh/react@rc?dev";
    import ReactDOMClient from "https://esm.sh/react-dom@rc/client/?dev";

    const rootElement = ReactDOMClient.createRoot(document.getElementById("root"));

    function App() {
        const [chatRooms, setChatRooms] = useState([]);

        useEffect(() => {
            fetch("http://localhost:8070/api/v1/chat/rooms")
                .then((response) => response.json())
                .then((data) => {
                    data.reverse();
                    setChatRooms(data);
                });
        }, []);

        const submitAddChatRoomForm = (e) => {
            e.preventDefault();

            const form = e.target;

            // 양쪽 공백제거
            form.name.value = form.name.value.trim();

            if (form.name.value.length == 0) {
                alert("채팅방 이름을 입력해주세요.");
                form.name.focus();
                return;
            }

            const lastChatRoomId = chatRooms.length == 0 ? 0 : chatRooms[0].id;

            const name = form.name.value;

            form.name.value = "";
            form.name.focus();

            fetch("http://localhost:8070/api/v1/chat/rooms", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: name
                })
            })
                .then((response) => response.json())
                .then((data) => {
                    const newChatRoom = {
                        id: data.id,
                        createDate: data.createDate,
                        name: data.name
                    };

                    setChatRooms([newChatRoom, ...chatRooms]);
                });
        };

        return (
            <>
                <h1 className="font-bold text-lg">채팅방 생성</h1>
                <form
                    className="mt-2 flex gap-2"
                    onSubmit={(e) => submitAddChatRoomForm(e)}
                >
                    <input
                        className="border rounded p-2"
                        type="text"
                        name="name"
                        placeholder="채팅방 이름"
                    />
                    <input className="border p-2" type="submit" value="채팅방 생성" />
                </form>

                <hr className="my-2" />

                <h1 className="font-bold text-lg">채팅방 목록</h1>

                <ul>
                    {chatRooms.map((chatRoom) => (
                        <li key={chatRoom.id}>
                            {chatRoom.id} / {chatRoom.name}
                        </li>
                    ))}
                </ul>
            </>
        );
    }

    rootElement.render(<App />);


</script>